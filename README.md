# Как развернуть кластер

* Получить из reg.ru домен и WILDCARD (!) сертификат для него
* Иметь ubuntu 20+ на всех нодах
* Иметь возможность подключаться к каждой ноде через root пользователя по ssh
* Отключить ufw на нодах (`ufw disable`)
* Если трафик идет через роутер, то прокинуть порты 2379-2380, 6443, 10250, 51820-51821
* Установить curl, kubectl и Helm на главной ноде
* Положить данные сертификатов в `certs/tls.crt` (конкатенация публичного ключа и всех промежуточных сертификатов,
  разделенных новой строкой, сначала идет публичный ключ), `certs/tls.key` (приватный ключ) и `certs/ca.rt` (корневой
  сертификат) файлы
* Настроить `config.yaml` (см. `config.yaml.example`)
* Запустить `go run main.go`

# После запуска скрипта

* Создать в Github/Gitea репозиторий `%cluster_name%_config`
  * Настроить вебхуки для арго (секрет - `.user.secret` в конфиге)
* (Private) Создать в Gitea репозиторий `%cluster_name%_charts`
  * Настроить вебхуки для арго (секрет - `.user.secret` в конфиге)
* (Private) Создать все необходимые репозитории в Gitea
  * Настроить зеркалирование в Github
* (Private) Развернуть Gitea Act Agent на другой ноде
  * Подключить его к Gitea
* Создать проект в ArgoCD
  * Добавить репозитории, созданные выше
* Начать добавлять приложения =)
